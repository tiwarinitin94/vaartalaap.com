function pattern_getter(e,i){$.post(url_vrt+"message/get_pattern/",{c_id:e},function(e){id_record.push(e[0].cr_id),++counter==i.length&&(id_record.sort(function(e,i){return i-e}),counter=0,call_create())},"json")}function call_create(){for(x=0;x<id_record.length;x++)create_user_list(id_record[x],x,id_record.length)}function create_user_list(e,i,t){$.post(url_vrt+"message/create_user_data/IDIOTS_CHECK_THIS_OUT_FOR_Create"+i,{cr_id:e},function(e){obj.push(e),++counter==t&&(counter=0,call_obj())},"json")}function call_obj(){for(obj.sort(function(e,i){return e.oid-i.oid}),i=0;i<obj.length;i++)create_the_div(obj[i].cid,i,obj.length,obj[i].user_id_fk,obj[i].user_read)}function create_the_div(e,i,t,s,r){$.post(url_vrt+"message/create_the_div/IDIOTS_CHECK_THIS_OUT_FOR_Create"+i,{c_id:e,user_id_fk:s,user_read:r},function(e){obj_user.push(e),++counter==t&&(counter=0,call_obj2())},"json")}function call_obj2(){for(obj_user.sort(function(e,i){return e.x-i.x}),i=0;i<obj_user.length;i++)obj_user[i].user_id_fk!=u_l_id&&"no"==obj_user[i].user_read?color_new="5px 0px 6px 0px #777":color_new="none",$("#msg_div").append('<div id="'+obj_user[i].user_name+"_"+obj_user[i].u_id+'" onclick="find_message('+obj_user[i].c_id+');"style="cursor:pointer;clear:both;overflow:hidden;margin-top:2px;cursor:pointer;box-shadow:'+color_new+';border-bottom:.1px solid #efefef;"></div>'),profile_pic_check(obj_user[i].user_name,obj_user[i].u_id)}function profile_pic_check(e,i){$.ajax({url:url_vrt+"profile/get_user_friends_data",type:"POST",data:{added_by:e},error:function(){},success:function(t){""==t.trim()?$("#"+e+"_"+i).append("<img height='60' width='60'style='cursor:pointer;padding:5px;border-radius:50%;float:left;'title='"+e+"' src='"+url_vrt+"public/images/default-pic.png'/><label style='cursor:pointer;padding:20px 10px;float:left;'>"+e+"</label>"):$("#"+e+"_"+i).append("<img height='60' width='60'style='cursor:pointer;padding:5px;border-radius:50%;float:left;' title='"+e+"' src='"+url_vrt+"public/userdata/profile_pics/"+t+"'/><label style='cursor:pointer;padding:20px 10px;float:left;' >"+e+"</label>")}})}function find_message(e){move(),fetch_message(e,"",$('#msg_data')),$("#this_counter_for_cid").html(""),$("#this_counter_for_cid").html(e)}function move(){$("#msg_data").show(),$("#uploadimage").show(),$('.msg_d').show()}var id_record=new Array,counter=0,obj=new Array,obj_user=new Array,the_new_crid="now",lastScrollTop=0,lastScrollHeight=0,img=document.createElement("img");$(document).ready(function(){$.get(url_vrt+"message/get_u_data/"+user_logged,function(e){if("getout"==e[0].response)$("#msg_div").append('<div id="error"><label style="color:#999;">Seems like you don\'t have any messages at all. </label></div>');else for(i=0;i<e.length;i++)pattern_getter(e[i].c_id,e)},"json"),$("#msg_data").scroll(function(e){msgarea=document.getElementById("msg_data");var i=$(this).scrollTop();i==msgarea.scrollHeight?setInterval(function(){fetch_message($("#this_counter_for_cid").html(),"",$('#msg_data'))},4500):i==lastScrollTop&&"Nothing"!=$("#this_counter_for_cr_id").html()&&(fetch_cid=$("#this_counter_for_cid").html(),fetch_message(fetch_cid,the_new_crid,$('#msg_data')))}),$(".msg_d").submit(function(e){var i=$("#uploadimage").attr("rel");return current_cid="thissdlfhdgjhasbgadbgbdfdahgljadfhadjfhadjfhdfhdsajfhjdfhdljfhdlasfhldfjadjfafjadfj"+$("#this_counter_for_cid").html(),e.preventDefault(),$.ajax({url:i+"/"+current_cid,type:"POST",data:new FormData(this),contentType:!1,async:!1,cache:!1,processData:!1,success:function(e){fetch_message($("#this_counter_for_cid").html(),"",$('#msg_data')),$("#msginput").val(""),document.getElementById("file").value="",$("#image_preview").html("")}}),!1})});	