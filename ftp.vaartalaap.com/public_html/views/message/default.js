function pattern_getter(e,i){$.post("message/get_pattern/",{c_id:e},function(e){id_record.push(e[0].cr_id),++counter==i.length&&(id_record.sort(function(e,i){return i-e}),counter=0,call_create())},"json")}function call_create(){for(x=0;x<id_record.length;x++)create_user_list(id_record[x],x,id_record.length)}function create_user_list(e,i,t){$.post("message/create_user_data/IDIOTS_CHECK_THIS_OUT_FOR_Create"+i,{cr_id:e},function(e){obj.push(e),++counter==t&&(counter=0,call_obj())},"json")}function call_obj(){for(obj.sort(function(e,i){return e.oid-i.oid}),i=0;i<obj.length;i++)create_the_div(obj[i].cid,i,obj.length,obj[i].user_id_fk,obj[i].user_read)}function create_the_div(e,i,t,s,r){$.post("message/create_the_div/IDIOTS_CHECK_THIS_OUT_FOR_Create"+i,{c_id:e,user_id_fk:s,user_read:r},function(e){obj_user.push(e),++counter==t&&(counter=0,call_obj2())},"json")}function call_obj2(){for(obj_user.sort(function(e,i){return e.x-i.x}),i=0;i<obj_user.length;i++)obj_user[i].user_id_fk!=u_l_id&&"no"==obj_user[i].user_read?color_new="5px 0px 6px 0px #777":color_new="none",$("#msg_div").append('<div id="'+obj_user[i].user_name+"_"+obj_user[i].u_id+'" onclick="find_message('+obj_user[i].c_id+');"style="cursor:pointer;clear:both;overflow:hidden;margin-top:2px;cursor:pointer;box-shadow:'+color_new+';border-bottom:.1px solid #efefef;"></div>'),profile_pic_check(obj_user[i].user_name,obj_user[i].u_id)}function profile_pic_check(e,i){$.ajax({url:url_vrt+"profile/get_user_friends_data",type:"POST",data:{added_by:e},error:function(){},success:function(t){""==t.trim()?$("#"+e+"_"+i).append("<img height='60' width='60'style='cursor:pointer;padding:5px;border-radius:50%;float:left;'title='"+e+"' src='"+url_vrt+"public/images/default-pic.png'/><label style='cursor:pointer;padding:20px 10px;float:left;'>"+e+"</label>"):$("#"+e+"_"+i).append("<img height='60' width='60'style='cursor:pointer;padding:5px;border-radius:50%;float:left;' title='"+e+"' src='"+url_vrt+"public/userdata/profile_pics/"+t+"'/><label style='cursor:pointer;padding:20px 10px;float:left;' >"+e+"</label>")}})}function find_message(e){move(),fetch_message(e,""),$("#this_counter_for_cid").html(""),$("#this_counter_for_cid").html(e)}function fetch_message(e,t){new Image;"now"==t?(fetch_cr_id=$("#this_counter_for_cr_id").html(),$.post(url_vrt+"message/get_the_anonymous_activity_that_is_going_out_there",{the_new_crid:fetch_cr_id,cid:e},function(e){for($("#this_counter_for_cr_id").html(""),e.sort(function(e,i){return i.cr_id-e.cr_id}),i=0;i<e.length;i++)$("#this_counter_for_cr_id").html(e[e.length-1].cr_id),"Nothing"!=e[i].pics?(pic_sent=url_vrt+"public/userdata/data_pics/"+e[i].pics,img.src=pic_sent,img_wdth=img.width,img_height=img.height,img_wdth>200?(img__wdth=200,img_height=img_height/img_wdth*img__wdth):img__wdth=img_wdth,pic_sent='<img src="'+url_vrt+"public/userdata/data_pics/"+e[i].pics+'" height="'+img_height+'" width="'+img__wdth+'"/>'):pic_sent="","Nothing"==e[0].Nothing?($("#msg_data").prepend('<center style="color:#999; padding:20px;background:#fbfbfb; font-size:12px;">No More Messages....</center>'),$("#this_counter_for_cr_id").html("Nothing")):e[i].username==user_logged?(""!=e[i].reply&&$("#msg_data").prepend('<div class="msgc" style="margin-bottom: 30px;"> <div class="msg msgfrom">'+e[i].reply+'</div><div class="msgarr msgarrfrom"></div><div class="msgsentby msgsentbyfrom">'+e[i].username+"</div> </div>"),"Nothing"!=e[i].pics&&$("#msg_data").prepend('<div class="msgc" style="margin-bottom: 30px;"><div class="msg msgfrom" style="padding:0px;background:transparent;">'+pic_sent+'</div><div class="msgarr msgarrfrom"></div><div class="msgsentby msgsentbyfrom">'+e[i].username+"</div> </div>")):(""!=e[i].reply&&$("#msg_data").prepend('<div class="msgc"> <div class="msg">'+e[i].reply+'</div></div><div class="msgarr"></div><div class="msgsentby">'+e[i].username+"</div>"),"Nothing"!=e[i].pics&&$("#msg_data").prepend('<div class="msgc"> <div class="msg" style="padding:0px;background:transparent;">'+pic_sent+'</div></div><div class="msgarr"></div><div class="msgsentby">'+e[i].username+"</div>"));msgarea=document.getElementById("msg_data");var t=msgarea.scrollHeight;if(t>lastScrollHeight){var s=t-lastScrollHeight;msgarea.scrollTop=s,lastScrollHeight=t}},"json")):$.post(url_vrt+"message/get_the_anonymous_activity_that_is_going_out_there",{cid:e},function(e){for(e.sort(function(e,i){return e.cr_id-i.cr_id}),$("#msg_data").html(""),$("#this_counter_for_cr_id").html(""),i=0;i<e.length;i++)"Nothing"!=e[i].pics?(pic_sent=url_vrt+"public/userdata/data_pics/"+e[i].pics,img.src=pic_sent,img_wdth=img.width,img_height=img.height,img_wdth>200?(img__wdth=200,img_height=img_height/img_wdth*img__wdth):img__wdth=img_wdth,pic_sent='<img src="'+url_vrt+"public/userdata/data_pics/"+e[i].pics+'" height="'+img_height+'" width="'+img__wdth+'"/>'):pic_sent="",$("#this_counter_for_cr_id").html(e[0].cr_id),e[i].username==user_logged?(""!=e[i].reply&&$("#msg_data").append('<div class="msgc" style="margin-bottom: 30px;"> <div class="msg msgfrom">'+e[i].reply+'</div><div class="msgarr msgarrfrom"></div><div class="msgsentby msgsentbyfrom">'+e[i].username+"</div> </div>"),"Nothing"!=e[i].pics&&$("#msg_data").append('<div class="msgc" style="margin-bottom: 30px;"><div class="msg msgfrom" style="padding:0px;background:transparent;">'+pic_sent+'</div><div class="msgarr msgarrfrom"></div><div class="msgsentby msgsentbyfrom">'+e[i].username+"</div> </div>")):(""!=e[i].reply&&$("#msg_data").append('<div class="msgc"> <div class="msg">'+e[i].reply+'</div></div><div class="msgarr"></div><div class="msgsentby">'+e[i].username+"</div>"),"Nothing"!=e[i].pics&&$("#msg_data").append('<div class="msgc"> <div class="msg" style="background:transparent;padding:0px;">'+pic_sent+'</div></div><div class="msgarr"></div><div class="msgsentby">'+e[i].username+"</div>"));msgarea=document.getElementById("msg_data"),msgarea.scrollTop=msgarea.scrollHeight,lastScrollHeight=msgarea.scrollHeight},"json")}function move(){$("#msg_data").show(),$("#uploadimage").show()}var id_record=new Array,counter=0,obj=new Array,obj_user=new Array,the_new_crid="now",lastScrollTop=0,lastScrollHeight=0,img=document.createElement("img");$(document).ready(function(){$.get("message/get_u_data/"+user_logged,function(e){if("getout"==e[0].response)$("#msg_div").append('<div id="error"><label style="color:#999;">Seems like you don\'t have any messages at all. </label></div>');else for(i=0;i<e.length;i++)pattern_getter(e[i].c_id,e)},"json"),$("#msg_data").scroll(function(e){msgarea=document.getElementById("msg_data");var i=$(this).scrollTop();i==msgarea.scrollHeight?setInterval(function(){fetch_message($("#this_counter_for_cid").html(),"")},4500):i==lastScrollTop&&"Nothing"!=$("#this_counter_for_cr_id").html()&&(fetch_cid=$("#this_counter_for_cid").html(),fetch_message(fetch_cid,the_new_crid))}),$("#uploadimage").submit(function(e){var i=$("#uploadimage").attr("rel");return current_cid="thissdlfhdgjhasbgadbgbdfdahgljadfhadjfhadjfhdfhdsajfhjdfhdljfhdlasfhldfjadjfafjadfj"+$("#this_counter_for_cid").html(),e.preventDefault(),$.ajax({url:i+"/"+current_cid,type:"POST",data:new FormData(this),contentType:!1,async:!1,cache:!1,processData:!1,success:function(e){fetch_message($("#this_counter_for_cid").html(),""),$("#msginput").val(""),document.getElementById("file").value="",$("#image_preview").html("")}}),!1})});